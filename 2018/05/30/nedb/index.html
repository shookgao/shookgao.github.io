<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />

    

    
    <title>NeDB 学习笔记 | SKBlog</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="学习笔记,NeDB,数据库" />
    
    <meta name="description" content="NeDB 是一个嵌入式的持久或者内存数据库，100% Javascript 编写，无二进制依赖；API 是 MongoDB 的一个子集并且它足够快。 安装npm install -S nedb API创建/加载一个数据库你可以把 NeDB 创建为一个内存数据库或者持久数据库，一个数据库相当于 MongoDB 的一个集合；new Datastore(options)是一个构造函数，options是一">
<meta name="keywords" content="学习笔记,NeDB,数据库">
<meta property="og:type" content="article">
<meta property="og:title" content="NeDB 学习笔记">
<meta property="og:url" content="https://shookgao.github.io/2018/05/30/nedb/index.html">
<meta property="og:site_name" content="SKBlog">
<meta property="og:description" content="NeDB 是一个嵌入式的持久或者内存数据库，100% Javascript 编写，无二进制依赖；API 是 MongoDB 的一个子集并且它足够快。 安装npm install -S nedb API创建/加载一个数据库你可以把 NeDB 创建为一个内存数据库或者持久数据库，一个数据库相当于 MongoDB 的一个集合；new Datastore(options)是一个构造函数，options是一">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-05-30T03:27:33.963Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="NeDB 学习笔记">
<meta name="twitter:description" content="NeDB 是一个嵌入式的持久或者内存数据库，100% Javascript 编写，无二进制依赖；API 是 MongoDB 的一个子集并且它足够快。 安装npm install -S nedb API创建/加载一个数据库你可以把 NeDB 创建为一个内存数据库或者持久数据库，一个数据库相当于 MongoDB 的一个集合；new Datastore(options)是一个构造函数，options是一">
    

    
        <link rel="alternate" href="/" title="SKBlog" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.2.4/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    


</head>

<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                        <h2 class="subtitle-wrap">
                            <p class="subtitle">比昨天的自己更好一点儿...</p>
                        </h2>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/">主页</a>
                                </li>
                            
                                        
                                    
                                <li class="main-nav-list-item" >
                                    <a class="main-nav-list-link" href="/about/index.html">关于</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    未分类
    </h1>
</div>
                        <div class="main-body-content">
                            <article id="post-nedb" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        NeDB 学习笔记
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
        <a href="/2018/05/30/nedb/" class="article-date">
            <time datetime="2018-05-29T16:00:00.000Z" itemprop="datePublished">2018-05-30</time>
        </a>
    </div>

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/NeDB/">NeDB</a>, <a class="tag-link" href="/tags/学习笔记/">学习笔记</a>, <a class="tag-link" href="/tags/数据库/">数据库</a>
    </div>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <p>NeDB 是一个嵌入式的持久或者内存数据库，100% Javascript 编写，无二进制依赖；API 是 MongoDB 的一个子集并且它足够快。</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><code>npm install -S nedb</code></p>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><p><strong>创建/加载一个数据库</strong><br>你可以把 NeDB 创建为一个内存数据库或者持久数据库，一个数据库相当于 MongoDB 的一个集合；<code>new Datastore(options)</code>是一个构造函数，<code>options</code>是一个对象并有以下字段：<br><em>filename</em>：可选，数据被持久存放的路径，如果留空，数据库会被创建在内存中。它不能以<code>~</code>结束，因为 NeDB 的临时文件要用。<br><em>inMemoryOnly</em>：可选，默认<code>false</code>，就如名字所标识的那个意思。<br><em>timestampData</em>：可选，默认<code>false</code>，所有文档插入和更新的时间戳，有两个字段：<code>createAt</code>和<code>updateAt</code>。用户指定的值会覆盖自动生产的值，通常用于测试。<br><em>autoload</em>：可选，默认<code>false</code>，如果适用，数据库文件会被自动加载，你不需要再使用<code>loadDatastore</code>命令，所有命令在加载完成前被缓存，并在加载完成后被执行。<br><em>onload</em>：可选，假如你使用自动加载，它会在<code>loadDatastore</code>后被调用，它得到一个<code>error</code>提要，当你在自动加载的时候没有指定处理器，在加载的时候发生的错误将会被抛弃。<br><em>afterSerialization</em>：你可以使用这个钩子在数据被序列化后写入磁盘文件之前转换数据，比如在写入磁盘之前加密数据，这个函数接收一个字符串作为参数，并输出转换后的字符串，必须保证不出现<code>\n</code>字符，这可能会造成数据丢失。<br><em>beforeDeserialization</em>：和<code>afterSerialization</code>相反，并且必须两个一起使用。<br><em>corruptAlertThreshold</em>：可选，在0和1之间，默认10%，如果数据损失超过这个值，NeDB 将不能启动。<br><em>compareStrings</em>：可选，函数 compareStrings(a, b) 比较字符串 a 和 b 返回-1、0、1，如果指定，它将会覆盖默认的字符串比较函数因为默认函数不能很好的适配非美国字符，特别是重音字母，原生<code>localCompare</code>在绝大多数情况下是一个更好的选择。<br>假如你使用一个持久数据库并且没有使用<code>autoload</code>选项，你必须手工调用<code>loadDatastore</code>，否则所有命令都将不能执行。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">// Type 1: 内存数据库(不需要加载数据库)</span><br><span class="line">var Datastore = require(&apos;nedb&apos;)</span><br><span class="line">  , db = new Datastore();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// Type 2: 持久数据库手工加载</span><br><span class="line">var Datastore = require(&apos;nedb&apos;)</span><br><span class="line">  , db = new Datastore(&#123; filename: &apos;path/to/datafile&apos; &#125;);</span><br><span class="line">db.loadDatabase(function (err) &#123;    // Callback is optional</span><br><span class="line">  // Now commands will be executed</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// Type 3: 持久数据库自动加载</span><br><span class="line">var Datastore = require(&apos;nedb&apos;)</span><br><span class="line">  , db = new Datastore(&#123; filename: &apos;path/to/datafile&apos;, autoload: true &#125;);</span><br><span class="line">// 你现在可以马上发布命令。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 当然如果你需要多个数据库你可以创建多个</span><br><span class="line">// 集合. 在这种情况下为所有集合使用自动加载通常是个好办法.</span><br><span class="line">db = &#123;&#125;;</span><br><span class="line">db.users = new Datastore(&apos;path/to/users.db&apos;);</span><br><span class="line">db.robots = new Datastore(&apos;path/to/robots.db&apos;);</span><br><span class="line"></span><br><span class="line">// 你必须加载所有数据库 (这儿我们异步处理它。)</span><br><span class="line">db.users.loadDatabase();</span><br><span class="line">db.robots.loadDatabase();</span><br></pre></td></tr></table></figure></p>
<p><strong>持久化方案</strong><br><code>NeDB</code>持久化使用附加格式，所有升级和删除的实际结果会加到数据文件的末尾。数据库自动压实。你的应用程序每次都会加载整个数据库。<br>压实会花费一点儿时间，在这个时间内其他操作都会被停止，因此大多数项目实际上没必要使用它。<br><strong>插入文档</strong><br>原生类型是<code>String</code>、<code>Number</code>、<code>Boolean</code>、<code>Date</code>和<code>null</code>，你也可以使用数组和子文档（对象），假如一个字段是<code>undefined</code>，它将不会被保存（这和<code>MongoDB</code>不同，它是把<code>undefined</code>转换为<code>null</code>）。<br>如果文档不包含<code>_id</code>字段，<code>NeDB</code>将会为你自动生成一个（一个16字符的字母数字字符串）。文档的<code>_id</code>字段一旦被设置就不能被修改。<br>字段名不能以<code>$</code>开头并且不能包含<code>.</code>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var doc = &#123; hello: &apos;world&apos;</span><br><span class="line">               , n: 5</span><br><span class="line">               , today: new Date()</span><br><span class="line">               , nedbIsAwesome: true</span><br><span class="line">               , notthere: null</span><br><span class="line">               , notToBeSaved: undefined  // 不保存</span><br><span class="line">               , fruits: [ &apos;apple&apos;, &apos;orange&apos;, &apos;pear&apos; ]</span><br><span class="line">               , infos: &#123; name: &apos;nedb&apos; &#125;</span><br><span class="line">               &#125;;</span><br><span class="line"></span><br><span class="line">db.insert(doc, function (err, newDoc) &#123;   // Callback is optional</span><br><span class="line">  // newDoc是最近插入的文档, 包含它的_id</span><br><span class="line">  // newDoc 没有叫notToBeSaved的字段因为它的值是undefined。</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>你也能够插入一个文档数组，这个操作是自动的，如果数组中的一个文档插入失败，那么所有数据都将回滚。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">db.insert([&#123; a: 5 &#125;, &#123; a: 42 &#125;], function (err, newDocs) &#123;</span><br><span class="line">  // 两个文档被插入数据库中。</span><br><span class="line">  // newDocs是这两个文档的数组, 增加了他们的_id</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 假如在字段`a`上有唯一约束, 操作将会失败。</span><br><span class="line">db.insert([&#123; a: 5 &#125;, &#123; a: 42 &#125;, &#123; a: 5 &#125;], function (err) &#123;</span><br><span class="line">  // err 是一个 &apos;uniqueViolated&apos; 错误</span><br><span class="line">  // 数据库没有被改变</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><strong>查找文档</strong><br>使用<code>find</code>查找多个文档，使用<code>findOne</code>查找你指定的一个文档。你也能够选择文档基于字段相等或者比较操作符(<code>$lt</code>, <code>$lte</code>, <code>$gt</code>, <code>$gte</code>, <code>$in</code>, <code>$nin</code>, <code>$ne</code>)，你也能够使用逻辑操作符<code>$or</code>、<code>$and</code>、<code>$not</code>和<code>$where</code>，看下面的语法。<br>你有两种办法使用正则表达式：在基础查询里面替换一个字符串，或者使用<code>$regex</code>操作符。<br>你能够排序和分页使用游标 API。<br>你能够使用标准预测限制字段出现在结果中。<br><em>基础查询</em><br>标准查询意思是根据你指定的字段匹配查找文档。你能用正则表达式匹配字符串。为了匹配一个数组中的指定元素，你可以使用点符号在嵌入式文档、数组、子文档数组中导航。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">// 我们的数据库中包含一下的集合</span><br><span class="line">// &#123; _id: &apos;id1&apos;, planet: &apos;Mars&apos;, system: &apos;solar&apos;, inhabited: false, satellites: [&apos;Phobos&apos;, &apos;Deimos&apos;] &#125;</span><br><span class="line">// &#123; _id: &apos;id2&apos;, planet: &apos;Earth&apos;, system: &apos;solar&apos;, inhabited: true, humans: &#123; genders: 2, eyes: true &#125; &#125;</span><br><span class="line">// &#123; _id: &apos;id3&apos;, planet: &apos;Jupiter&apos;, system: &apos;solar&apos;, inhabited: false &#125;</span><br><span class="line">// &#123; _id: &apos;id4&apos;, planet: &apos;Omicron Persei 8&apos;, system: &apos;futurama&apos;, inhabited: true, humans: &#123; genders: 7 &#125; &#125;</span><br><span class="line">// &#123; _id: &apos;id5&apos;, completeData: &#123; planets: [ &#123; name: &apos;Earth&apos;, number: 3 &#125;, &#123; name: &apos;Mars&apos;, number: 2 &#125;, &#123; name: &apos;Pluton&apos;, number: 9 &#125; ] &#125; &#125;</span><br><span class="line"></span><br><span class="line">// 在太阳系中找出所有行星</span><br><span class="line">db.find(&#123; system: &apos;solar&apos; &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 是一个包含 Mars, Earth, Jupiter 的数组</span><br><span class="line">  // 假如没有文档被发现, docs 等于 []</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 使用正则表达式找出名称中包含 ar 的行星</span><br><span class="line">db.find(&#123; planet: /ar/ &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 包含 Mars 和 Earth</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 找出太阳系中有人居住的行星</span><br><span class="line">db.find(&#123; system: &apos;solar&apos;, inhabited: true &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 是一个仅仅包含文档 Earth 的数组</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 使用点符号在子文档中匹配字段</span><br><span class="line">db.find(&#123; &quot;humans.genders&quot;: 2 &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 包含 Earth</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 使用点符号在子文档数组中导航</span><br><span class="line">db.find(&#123; &quot;completeData.planets.name&quot;: &quot;Mars&quot; &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 包含文档 5</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">db.find(&#123; &quot;completeData.planets.name&quot;: &quot;Jupiter&quot; &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 是空</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">db.find(&#123; &quot;completeData.planets.0.name&quot;: &quot;Earth&quot; &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 包含文档 5</span><br><span class="line">  // 假如我们把字段值换成 &quot;Mars&quot; docs 将是空的因为我们匹配了一个指定的数组元素。</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// 你也可以深度比较对象. 不要使用点符号!</span><br><span class="line">db.find(&#123; humans: &#123; genders: 2 &#125; &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 是空的, 因为 &#123; genders: 2 &#125; 不等于 &#123; genders: 2, eyes: true &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 在这个集合中查找所有文档</span><br><span class="line">db.find(&#123;&#125;, function (err, docs) &#123;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 当你想找一个文档的时候使用 findOne，使用规则一样</span><br><span class="line">db.findOne(&#123; _id: &apos;id1&apos; &#125;, function (err, doc) &#123;</span><br><span class="line">  // doc 是文档 Mars</span><br><span class="line">  // 假如没有文档被发现, doc 是 null</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><em>操作符 (<code>$lt</code>, <code>$lte</code>, <code>$gt</code>, <code>$gte</code>, <code>$in</code>, <code>$nin</code>, <code>$ne</code>, <code>$exists</code>, <code>$regex</code>)</em><br>这个语法是<code>{ field: { $op: value } }</code>，<code>$op</code>是任意比较操作符。</p>
<ul>
<li><code>$lt</code>,<code>$lte</code>：小于，小于或等于</li>
<li><code>$gt</code>,<code>$gte</code>：大于，大于或等于</li>
<li><code>$in</code>：<code>.value</code>的成员，必须是一个数组值</li>
<li><code>$ne</code>,<code>nin</code>：不等于，不是一个成员</li>
<li><code>$exists</code>：检查字段是否存在，值是 true 或者 false</li>
<li><code>$regex</code>：检查一个字符串是否被正则表达式匹配。和 <code>MongoDB</code>相反，<code>NeDB</code>的<code>$regex</code>不支持<code>$options</code>，因为它并没有什么卵用。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">// $lt, $lte, $gt and $gte 工作在数字和字符串上</span><br><span class="line">db.find(&#123; &quot;humans.genders&quot;: &#123; $gt: 5 &#125; &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 包含 Omicron Persei 8, 它的 humans.genders 是7，大于5.</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 当使用在字符串上的时候，使用字典排序</span><br><span class="line">db.find(&#123; planet: &#123; $gt: &apos;Mercury&apos; &#125;&#125;, function (err, docs) &#123;</span><br><span class="line">  // docs contains Omicron Persei 8</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 使用 $in. $nin 的方法是一样的</span><br><span class="line">db.find(&#123; planet: &#123; $in: [&apos;Earth&apos;, &apos;Jupiter&apos;] &#125;&#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 包含 Earth and Jupiter</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 使用 $exists</span><br><span class="line">db.find(&#123; satellites: &#123; $exists: true &#125; &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 只包含 Mars</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 有多个操作符的时候，正则表达式要使用操作符 $regex </span><br><span class="line">db.find(&#123; planet: &#123; $regex: /ar/, $nin: [&apos;Jupiter&apos;, &apos;Earth&apos;] &#125; &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 仅仅包含 Mars 因为 Earth 被 $nin 匹配了</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><em>数组字段</em><br>当一个文档的值是一个数组时，<code>NeDB</code>首先会看查询的值是不是数组，是的话就进行一个精确匹配，然后看是不是有数组比较函数，如果也没有，将会进行模糊匹配。</p>
<ul>
<li><code>$size</code>：匹配数组的大小</li>
<li><code>$elemMatch</code>：至少有一个元素匹配<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">// 精确匹配</span><br><span class="line">db.find(&#123; satellites: [&apos;Phobos&apos;, &apos;Deimos&apos;] &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 包含 Mars</span><br><span class="line">&#125;)</span><br><span class="line">db.find(&#123; satellites: [&apos;Deimos&apos;, &apos;Phobos&apos;] &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 是空的，不同顺序也不行</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 使用指定的数组匹配函数</span><br><span class="line">// $elemMatch 操作符为一个文档提供匹配, 假如数组中的元素满足 `$elemMatch` 操作符的所有约束</span><br><span class="line">db.find(&#123; completeData: &#123; planets: &#123; $elemMatch: &#123; name: &apos;Earth&apos;, number: 3 &#125; &#125; &#125; &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 包含文档 id 5 (completeData)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">db.find(&#123; completeData: &#123; planets: &#123; $elemMatch: &#123; name: &apos;Earth&apos;, number: 5 &#125; &#125; &#125; &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 是空的</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 你能够在 #elemMatch 查询里面使用任何的文档操作符</span><br><span class="line">db.find(&#123; completeData: &#123; planets: &#123; $elemMatch: &#123; name: &apos;Earth&apos;, number: &#123; $gt: 2 &#125; &#125; &#125; &#125; &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 包含文档 id 5 (completeData)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 注意：你不能在 $size 操作符里面使用比较函数, e.g. &#123; $size: &#123; $lt: 5 &#125; &#125; 将会抛出一个错误</span><br><span class="line">db.find(&#123; satellites: &#123; $size: 2 &#125; &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 包含 Mars</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">db.find(&#123; satellites: &#123; $size: 1 &#125; &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 是空的</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 假如文档的字段是一个数组, 匹配一个意味着匹配数组中的任意一个。</span><br><span class="line">db.find(&#123; satellites: &apos;Phobos&apos; &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 包含 Mars. 使用 &#123; satellites: &apos;Deimos&apos; &#125; 匹配是一样的结果</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 这种查询的方式也可以使用比较函数</span><br><span class="line">db.find(&#123; satellites: &#123; $lt: &apos;Amos&apos; &#125; &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 是空的</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// $in and $nin 操作符也可以工作</span><br><span class="line">db.find(&#123; satellites: &#123; $in: [&apos;Moon&apos;, &apos;Deimos&apos;] &#125; &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 包含 Mars (Earth 文档是不完整的!)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><em>逻辑操作符 <code>$or</code>, <code>$and</code>, <code>$not</code>, <code>$where</code></em><br>你能够使用逻辑操作符组合查询：</p>
<ul>
<li><code>$or</code>,<code>$and</code>：语法是<code>{ $op: [query1, query2, ...] }</code></li>
<li><code>$not</code>：语法是<code>{ $not: query }</code></li>
<li><code>$where</code>：语法是<code>{ $where: function () { /* object is &quot;this&quot;, return a boolean */ } }</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">db.find(&#123; $or: [&#123; planet: &apos;Earth&apos; &#125;, &#123; planet: &apos;Mars&apos; &#125;] &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 包含 Earth 和 Mars</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">db.find(&#123; $not: &#123; planet: &apos;Earth&apos; &#125; &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 包含 Mars, Jupiter, Omicron Persei 8</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">db.find(&#123; $where: function () &#123; return Object.keys(this) &gt; 6; &#125; &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs 字段大于6个</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 你能够混合普通查询、比较函数和逻辑操作符</span><br><span class="line">db.find(&#123; $or: [&#123; planet: &apos;Earth&apos; &#125;, &#123; planet: &apos;Mars&apos; &#125;], inhabited: true &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs contains Earth</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><em>排序和分页</em><br>假如你不给 find,findOne,count 指定回调函数，一个游标对象将被返回，你能够用 sort,skip,limit 修改游标后使用<code>exec(callback)</code>执行它。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">// 我们的数据库包含4个文档</span><br><span class="line">// doc1 = &#123; _id: &apos;id1&apos;, planet: &apos;Mars&apos;, system: &apos;solar&apos;, inhabited: false, satellites: [&apos;Phobos&apos;, &apos;Deimos&apos;] &#125;</span><br><span class="line">// doc2 = &#123; _id: &apos;id2&apos;, planet: &apos;Earth&apos;, system: &apos;solar&apos;, inhabited: true, humans: &#123; genders: 2, eyes: true &#125; &#125;</span><br><span class="line">// doc3 = &#123; _id: &apos;id3&apos;, planet: &apos;Jupiter&apos;, system: &apos;solar&apos;, inhabited: false &#125;</span><br><span class="line">// doc4 = &#123; _id: &apos;id4&apos;, planet: &apos;Omicron Persei 8&apos;, system: &apos;futurama&apos;, inhabited: true, humans: &#123; genders: 7 &#125; &#125;</span><br><span class="line"></span><br><span class="line">// 没有查询条件意味着所有结果被返回 (在游标修改前)</span><br><span class="line">db.find(&#123;&#125;).sort(&#123; planet: 1 &#125;).skip(1).limit(2).exec(function (err, docs) &#123;</span><br><span class="line">  // docs 是 [doc3, doc1]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 你可以像下面这样反向排序</span><br><span class="line">db.find(&#123; system: &apos;solar&apos; &#125;).sort(&#123; planet: -1 &#125;).exec(function (err, docs) &#123;</span><br><span class="line">  // docs is [doc1, doc3, doc2]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 你可以排序一个字段，然后另一个字段，像下面那样操作:</span><br><span class="line">db.find(&#123;&#125;).sort(&#123; firstField: 1, secondField: -1 &#125;) ...   // You understand how this works!</span><br></pre></td></tr></table></figure></p>
<p><em>预测</em><br>你能够给 find, findOne 第二个可选的参数，<code>projections</code>，这个语法和<code>MongoDB</code>一样：<code>{ a: 1, b: 1 }</code>表明要返回这两个字段，<code>{ a: 0, b: 0 }</code>表明不要返回这两个字段，这两个方式不能同时使用，除了<code>_id</code>这个字段总是会返回，你可以省略它。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">// 和上面的数据库一样</span><br><span class="line"></span><br><span class="line">// 仅仅要给出的字段</span><br><span class="line">db.find(&#123; planet: &apos;Mars&apos; &#125;, &#123; planet: 1, system: 1 &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs is [&#123; planet: &apos;Mars&apos;, system: &apos;solar&apos;, _id: &apos;id1&apos; &#125;]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 保持给出的字段并省略_id</span><br><span class="line">db.find(&#123; planet: &apos;Mars&apos; &#125;, &#123; planet: 1, system: 1, _id: 0 &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs is [&#123; planet: &apos;Mars&apos;, system: &apos;solar&apos; &#125;]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 省略给出的字段</span><br><span class="line">db.find(&#123; planet: &apos;Mars&apos; &#125;, &#123; planet: 0, system: 0, _id: 0 &#125;, function (err, docs) &#123;</span><br><span class="line">  // docs is [&#123; inhabited: false, satellites: [&apos;Phobos&apos;, &apos;Deimos&apos;] &#125;]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 失败: 在同一次使用了两个方式</span><br><span class="line">db.find(&#123; planet: &apos;Mars&apos; &#125;, &#123; planet: 0, system: 1 &#125;, function (err, docs) &#123;</span><br><span class="line">  // err is the error message, docs is undefined</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 你也可以在游标中使用这个方式，但是和 MongoDB 不兼容</span><br><span class="line">db.find(&#123; planet: &apos;Mars&apos; &#125;).projection(&#123; planet: 1, system: 1 &#125;).exec(function (err, docs) &#123;</span><br><span class="line">  // docs is [&#123; planet: &apos;Mars&apos;, system: &apos;solar&apos;, _id: &apos;id1&apos; &#125;]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 在嵌入文档中使用</span><br><span class="line">db.findOne(&#123; planet: &apos;Earth&apos; &#125;).projection(&#123; planet: 1, &apos;humans.genders&apos;: 1 &#125;).exec(function (err, doc) &#123;</span><br><span class="line">  // doc is &#123; planet: &apos;Earth&apos;, _id: &apos;id2&apos;, humans: &#123; genders: 2 &#125; &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><em>文档计数</em><br>你能够使用 count 来计数，它的语法和 find 一样，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 计数太阳系中所有行星</span><br><span class="line">db.count(&#123; system: &apos;solar&apos; &#125;, function (err, count) &#123;</span><br><span class="line">  // count 等于 3</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// Count 数据库中所有文档</span><br><span class="line">db.count(&#123;&#125;, function (err, count) &#123;</span><br><span class="line">  // count 等于 4</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p><strong>更新文档</strong><br><code>db.update(query, update, options, callback)</code>将会升级所有匹配<code>query</code>的文档的<code>update</code>:</p>
<ul>
<li><code>query</code>的方法和<code>find</code>方法一样。</li>
<li><code>update</code>指定要更新什么内容，这是一个新文档或者一组字段修改。<ul>
<li>新文档会替换旧文档</li>
<li>如果字段不存在会新增，可用字段修改使用<code>$set</code>，<code>$unset</code>会删除一个字段，<code>$inc</code>增加一个字段的值，还有<code>$min</code>和<code>$max</code>不知道有什么用；为了工作在数组上，你还可用<code>$push</code>, <code>$pop</code>, <code>$addToSet</code>, <code>$pull</code>, <code>$each</code> and <code>$slice</code>。</li>
</ul>
</li>
<li><code>options</code>是有两个可能参数的对象<ul>
<li><code>multi</code>：默认是<code>false</code>，同时修改多个文档</li>
<li><code>upsert</code>：默认是<code>false</code></li>
<li><code>returnUpdatedDocs</code>：默认是<code>false</code>，和<code>MongoDB</code>不兼容</li>
</ul>
</li>
<li><code>callback</code>：可选，(err, numAffected, affectedDocuments, upsert)<ul>
<li>在upsert时，<code>affectedDocuments</code>包含插入的文档，upsert标志是true</li>
<li>在标准更新中并且<code>returnUpdatedDocs</code>设置为<code>false</code>时，<code>affectedDocuments</code>不会被设置。</li>
<li>在标准更新中并且<code>returnUpdatedDocs</code>设置为true并且<code>multi</code>为<code>false</code>时，<code>affectedDocuments</code>是更新文档</li>
<li>在标准更新中并且<code>returnUpdatedDocs</code>设置为true并且<code>multi</code>为<code>true</code>时，<code>affectedDocuments</code>是更新文档数组。<br>注意：你不能改变一个文档的_id<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">// 我们的数据库是这样</span><br><span class="line">// &#123; _id: &apos;id1&apos;, planet: &apos;Mars&apos;, system: &apos;solar&apos;, inhabited: false &#125;</span><br><span class="line">// &#123; _id: &apos;id2&apos;, planet: &apos;Earth&apos;, system: &apos;solar&apos;, inhabited: true &#125;</span><br><span class="line">// &#123; _id: &apos;id3&apos;, planet: &apos;Jupiter&apos;, system: &apos;solar&apos;, inhabited: false &#125;</span><br><span class="line">// &#123; _id: &apos;id4&apos;, planet: &apos;Omicron Persia 8&apos;, system: &apos;futurama&apos;, inhabited: true &#125;</span><br><span class="line"></span><br><span class="line">// 替换一个文档</span><br><span class="line">db.update(&#123; planet: &apos;Jupiter&apos; &#125;, &#123; planet: &apos;Pluton&apos;&#125;, &#123;&#125;, function (err, numReplaced) &#123;</span><br><span class="line">  // numReplaced = 1</span><br><span class="line">  // 文档 #3 已经被替换成 &#123; _id: &apos;id3&apos;, planet: &apos;Pluton&apos; &#125;</span><br><span class="line">  // 注意这个`_id`是保持没变的</span><br><span class="line">  // (这个`system`和`inhabited`字段不在这儿了)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 设置一个已存在字段的值</span><br><span class="line">db.update(&#123; system: &apos;solar&apos; &#125;, &#123; $set: &#123; system: &apos;solar system&apos; &#125; &#125;, &#123; multi: true &#125;, function (err, numReplaced) &#123;</span><br><span class="line">  // numReplaced = 3</span><br><span class="line">  // 字段 &apos;system&apos; 在 Mars, Earth, Jupiter 里面现在是 &apos;solar system&apos;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 使用点符号在一个子文档里面设置一个不存在的字段的值</span><br><span class="line">db.update(&#123; planet: &apos;Mars&apos; &#125;, &#123; $set: &#123; &quot;data.satellites&quot;: 2, &quot;data.red&quot;: true &#125; &#125;, &#123;&#125;, function () &#123;</span><br><span class="line">  // Mars 文档现在是 &#123; _id: &apos;id1&apos;, system: &apos;solar&apos;, inhabited: false</span><br><span class="line">  //                      , data: &#123; satellites: 2, red: true &#125;</span><br><span class="line">  //                      &#125;</span><br><span class="line">  // 子文档中设置字段，你必须使用点符号</span><br><span class="line">  // 使用对象符号仅仅能够替换顶层字段</span><br><span class="line">  db.update(&#123; planet: &apos;Mars&apos; &#125;, &#123; $set: &#123; data: &#123; satellites: 3 &#125; &#125; &#125;, &#123;&#125;, function () &#123;</span><br><span class="line">    // Mars 现在是 &#123; _id: &apos;id1&apos;, system: &apos;solar&apos;, inhabited: false</span><br><span class="line">    //                      , data: &#123; satellites: 3 &#125;</span><br><span class="line">    //                      &#125;</span><br><span class="line">    // 你失去了 &quot;data.red&quot; 字段，这可能不是你想要的</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 删除一个字段</span><br><span class="line">db.update(&#123; planet: &apos;Mars&apos; &#125;, &#123; $unset: &#123; planet: true &#125; &#125;, &#123;&#125;, function () &#123;</span><br><span class="line">  // 现在 Mars 文档不包含 planet 字段</span><br><span class="line">  // 你可以使用点符号删除一个嵌入的字段</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 更新插入文档</span><br><span class="line">db.update(&#123; planet: &apos;Pluton&apos; &#125;, &#123; planet: &apos;Pluton&apos;, inhabited: false &#125;, &#123; upsert: true &#125;, function (err, numReplaced, upsert) &#123;</span><br><span class="line">  // numReplaced = 1, upsert = &#123; _id: &apos;id5&apos;, planet: &apos;Pluton&apos;, inhabited: false &#125;</span><br><span class="line">  // 一个新的文档 &#123; _id: &apos;id5&apos;, planet: &apos;Pluton&apos;, inhabited: false &#125; 已经被加到集合中。</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 假如你插入一个修改, 这个插入的文档是查询修改</span><br><span class="line">// 这比听起来更简单 :)</span><br><span class="line">db.update(&#123; planet: &apos;Pluton&apos; &#125;, &#123; $inc: &#123; distance: 38 &#125; &#125;, &#123; upsert: true &#125;, function () &#123;</span><br><span class="line">  // 一个新文档 &#123; _id: &apos;id5&apos;, planet: &apos;Pluton&apos;, distance: 38 &#125; 被加到这个集合  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// 假如我们在集合中插入一个 &#123; _id: &apos;id6&apos;, fruits: [&apos;apple&apos;, &apos;orange&apos;, &apos;pear&apos;] &#125; 文档,</span><br><span class="line">// 让我们看一下我们怎么修改数组字段</span><br><span class="line"></span><br><span class="line">// $push 在数组的结尾插入新的值</span><br><span class="line">db.update(&#123; _id: &apos;id6&apos; &#125;, &#123; $push: &#123; fruits: &apos;banana&apos; &#125; &#125;, &#123;&#125;, function () &#123;</span><br><span class="line">  // 现在这个fruits数组是 [&apos;apple&apos;, &apos;orange&apos;, &apos;pear&apos;, &apos;banana&apos;]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// $pop 移除一个元素，从结尾移除用1，从开始移除使用-1</span><br><span class="line">db.update(&#123; _id: &apos;id6&apos; &#125;, &#123; $pop: &#123; fruits: 1 &#125; &#125;, &#123;&#125;, function () &#123;</span><br><span class="line">  // 现在 fruits 数组是 [&apos;apple&apos;, &apos;orange&apos;]</span><br><span class="line">  // W使用 &#123; $pop: &#123; fruits: -1 &#125; &#125;, 结果会变成 [&apos;orange&apos;, &apos;pear&apos;]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// $addToSet adds an element to an array only if it isn&apos;t already in it</span><br><span class="line">// Equality is deep-checked (i.e. $addToSet will not insert an object in an array already containing the same object)</span><br><span class="line">// Note that it doesn&apos;t check whether the array contained duplicates before or not</span><br><span class="line">db.update(&#123; _id: &apos;id6&apos; &#125;, &#123; $addToSet: &#123; fruits: &apos;apple&apos; &#125; &#125;, &#123;&#125;, function () &#123;</span><br><span class="line">  // The fruits array didn&apos;t change</span><br><span class="line">  // If we had used a fruit not in the array, e.g. &apos;banana&apos;, it would have been added to the array</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// $pull removes all values matching a value or even any NeDB query from the array</span><br><span class="line">db.update(&#123; _id: &apos;id6&apos; &#125;, &#123; $pull: &#123; fruits: &apos;apple&apos; &#125; &#125;, &#123;&#125;, function () &#123;</span><br><span class="line">  // Now the fruits array is [&apos;orange&apos;, &apos;pear&apos;]</span><br><span class="line">&#125;);</span><br><span class="line">db.update(&#123; _id: &apos;id6&apos; &#125;, &#123; $pull: &#123; fruits: $in: [&apos;apple&apos;, &apos;pear&apos;] &#125; &#125;, &#123;&#125;, function () &#123;</span><br><span class="line">  // Now the fruits array is [&apos;orange&apos;]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// $each can be used to $push or $addToSet multiple values at once</span><br><span class="line">// This example works the same way with $addToSet</span><br><span class="line">db.update(&#123; _id: &apos;id6&apos; &#125;, &#123; $push: &#123; fruits: &#123; $each: [&apos;banana&apos;, &apos;orange&apos;] &#125; &#125; &#125;, &#123;&#125;, function () &#123;</span><br><span class="line">  // Now the fruits array is [&apos;apple&apos;, &apos;orange&apos;, &apos;pear&apos;, &apos;banana&apos;, &apos;orange&apos;]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// $slice can be used in cunjunction with $push and $each to limit the size of the resulting array.</span><br><span class="line">// A value of 0 will update the array to an empty array. A positive value n will keep only the n first elements</span><br><span class="line">// A negative value -n will keep only the last n elements.</span><br><span class="line">// If $slice is specified but not $each, $each is set to []</span><br><span class="line">db.update(&#123; _id: &apos;id6&apos; &#125;, &#123; $push: &#123; fruits: &#123; $each: [&apos;banana&apos;], $slice: 2 &#125; &#125; &#125;, &#123;&#125;, function () &#123;</span><br><span class="line">  // Now the fruits array is [&apos;apple&apos;, &apos;orange&apos;]</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">// $min/$max to update only if provided value is less/greater than current value</span><br><span class="line">// Let&apos;s say the database contains this document</span><br><span class="line">// doc = &#123; _id: &apos;id&apos;, name: &apos;Name&apos;, value: 5 &#125;</span><br><span class="line">db.update(&#123; _id: &apos;id1&apos; &#125;, &#123; $min: &#123; value: 2 &#125; &#125;, &#123;&#125;, function () &#123;</span><br><span class="line">  // The document will be updated to &#123; _id: &apos;id&apos;, name: &apos;Name&apos;, value: 2 &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">db.update(&#123; _id: &apos;id1&apos; &#125;, &#123; $min: &#123; value: 8 &#125; &#125;, &#123;&#125;, function () &#123;</span><br><span class="line">  // The document will not be modified</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>

        </div>
        <footer class="article-footer">
            



    <a data-url="https://shookgao.github.io/2018/05/30/nedb/" data-id="cjhsnii6n0001s4vlfo57k074" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>


                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>关注我 :</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="twitter" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-twitter"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="facebook" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-facebook"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="google-plus" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-google-plus"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/ppoffice/hexo-theme-hueman" target="_blank" rel="noopener">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="weibo" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-weibo"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="rss" href="/" target="_blank" rel="noopener">
                        <i class="icon fa fa-rss"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2018/05/30/ffmpeg/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">下一篇</strong>
        <p class="article-nav-title">
        
            FFmpeg 学习笔记
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
</nav>

    
    <div class="widgets-container">
        
            
                

            
                
    <div class="widget-wrap">
        <h3 class="widget-title">最新文章</h3>
        <div class="widget">
            <ul id="recent-post" class="">
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/05/30/ffmpeg/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/05/30/ffmpeg/" class="title">FFmpeg 学习笔记</a></p>
                            <p class="item-date"><time datetime="2018-05-29T16:00:00.000Z" itemprop="datePublished">2018-05-30</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-thumbnail">
                            <a href="/2018/05/30/nedb/" class="thumbnail">
    
    
        <span class="thumbnail-image thumbnail-none"></span>
    
    
</a>

                        </div>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2018/05/30/nedb/" class="title">NeDB 学习笔记</a></p>
                            <p class="item-date"><time datetime="2018-05-29T16:00:00.000Z" itemprop="datePublished">2018-05-30</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a><span class="archive-list-count">2</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">标签</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/NeDB/">NeDB</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ffmpeg/">ffmpeg</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/学习笔记/">学习笔记</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据库/">数据库</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">标签云</h3>
        <div class="widget tagcloud">
            <a href="/tags/NeDB/" style="font-size: 10px;">NeDB</a> <a href="/tags/ffmpeg/" style="font-size: 10px;">ffmpeg</a> <a href="/tags/学习笔记/" style="font-size: 20px;">学习笔记</a> <a href="/tags/数据库/" style="font-size: 10px;">数据库</a>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>

                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2018 John Doe</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
        </div>
    </div>
</footer>
        
    
    <script>
    var disqus_shortname = 'hexo-theme-hueman';
    
    
    var disqus_url = 'https://shookgao.github.io/2018/05/30/nedb/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>
